# Charles' Fvwm configuration file

# Commands
EdgeResistance 250 10
EdgeScroll 0 0
ClickTime 750
DesktopSize 3x3
ColormapFocus FollowsFocus
IgnoreModifiers L25
Emulate Mwm
BusyCursor Read off

# External files
Read themes/KDE1/theme

# Default styles
Style * ColorSet 41, HilightColorSet 40
Style * Icon /usr/share/icons/gnome/48x48/status/image-missing.png
Style * MiniIcon /usr/share/icons/gnome/16x16/status/image-missing.png
Style * DecorateTransient
Style * !UsePPosition 
Style * IconBox +0 +0 -0 -0, IconFill left bottom
Style * ClickToFocus
Style * PositionPlacement center
Style * FPLenient
Style * !StickyStippledTitle, !StickyStippledIconTitle
Style * ResizeHintOverride
Style * IconSize 57 57
Style * IconBackgroundColorset 43
Style * IconTitleColorset 43, HilightIconTitleColorset 44

# Module styles
Style "MainPager" !Title, Sticky, WindowListSkip, HandleWidth 3, BorderWidth 3, CirculateSkipIcon, CirculateSkip, NeverFocus, Layer 2
Style "PagerFrame" !Title, Sticky, WindowListSkip, HandleWidth 3, BorderWidth 3, CirculateSkipIcon, CirculateSkip, NeverFocus, Layer 2
Style "WMakerApps" !Title, Sticky, WindowListSkip, HandleWidth 3, BorderWidth 3, CirculateSkipIcon, CirculateSkip, NeverFocus, Layer 2
Style "QuitVerify" !Title, Sticky, WindowListSkip, CirculateSkipIcon, CirculateSkip, !Iconifiable, !Maximizable, !Closable

# Program styles
Style Gsimplecal !MwmDecor
Style urxvt Icon /usr/share/icons/gnome/48x48/apps/terminal.png, MiniIcon /usr/share/icons/gnome/16x16/apps/terminal.png

# Key bindings
Key Next A SCM Next (AcceptsFocus) Focus
Key Prior A SCM Prev (AcceptsFocus) Focus
Key Tab A M WindowList Root c c CurrentDesk, NoGeometryWithInfo, NoDeskNum, CurrentAtEnd
Key F1 A 1 Menu RootMenu Nop
Key F2 A 1 Exec urxvt
Key F3 A 1 Lower
Key F4 A 1 Close-and-Focus
Key F5 A 1 Raise
Key F6 A 1 WindowShade
Key F7 A 1 Move
Key F8 A 1 Resize
Key F9 A 1 Iconify-and-Focus
Key F10 A 1 Maximize
Key F11 A 1 Menu Window-Ops Nop
Key Escape A C WindowList Root c c NoGeometryWithInfo
Key r A C1 Restart
Key delete A C1 FvwmForm QuitVerify ACTION="Quit Fvwm" COMMAND="Quit"
Key l A C1 Exec loginctl lock-session
Key Left A C1 GoToPage-and-Focus -1p +0p
Key Right A C1 GoToPage-and-Focus +1p +0p
Key Up A C1 GoToPage-and-Focus +0p -1p
Key Down A C1 GoToPage-and-Focus +0p +1p
Key Left A S1 MoveToPage -1w +0w
Key Right A S1 MoveToPage +1w +0w
Key Up A S1 MoveToPage +0w -1w
Key Down A S1 MoveToPage +0w +1w
Key Up A C4 GoToDesk-and-Focus -1
Key Down A C4 GoToDesk-and-Focus +1
Key Up A S4 MoveToDesk-and-Focus -1
Key Down A S4 MoveToDesk-and-Focus +1
Key Left A 4 TileLeft
Key Right A 4 TileRight
Key Up A 4 TileTop
Key Down A 4 TileBottom
Key J A 4 Jump-to-Window
Key S A 4 ThisWindow (!Iconic, !Shaded) Move 50-50w 50-50w
Key I A 4 All (CurrentPage, Iconifiable, AcceptsFocus) Iconify True
Key XF86MonBrightnessUp A N Exec xbacklight -inc 10
Key XF86MonBrightnessDown A N Exec xbacklight -dec 10
Key Print A N Exec scrot -e 'xdg-open $f'
Key Print A S Exec tkscrot.py

# Mouse bindings
# Root window
Mouse 1 R A -
Mouse 2	R A -
Mouse 3	R A Menu RootMenu Nop

# Windows/borders/icons
Mouse 1	F A Resize-or-Raise
Mouse 1	TS A Move-or-Raise
Mouse 1	I A Move-or-Iconify
Mouse 1 W 1 Move-or-Raise
Mouse 2	I A Iconify-and-Focus
Mouse 2	FST A RaiseLower
Mouse 3	TSIF A Menu Window-Ops Nop

# Initialisation
DestroyFunc StartFunction
AddToFunc StartFunction
+ I Module FvwmPager MainPager *
+ I Module FvwmButtons PagerFrame
+ I Module FvwmButtons WMakerApps
+ I Test (!Init) Break
# Run mwmmenu on startup to avoid a slow firstrun
+ I Exec mwmmenu > /dev/null 2>&1 &
# Pause needed otherwise background not set (race condition??)
+ I Exec sleep 0.2 && nitrogen --restore > /dev/null 2>&1 &
+ I Exec wmsystemtray --non-wmaker > /dev/null 2>&1 &
+ I Exec wmclock -noblink -exe gsimplecal > /dev/null 2>&1 &
+ I Exec nm-applet > /dev/null 2>&1 &
+ I Exec cbatticon -c "xmessage -center 'Power is critically low. Please take action.'" -r 5 > /dev/null 2>&1 &
+ I Exec volumeicon > /dev/null 2>&1 &
+ I Exec blueman-applet > /dev/null 2>&1 &
+ I Exec xscreensaver -nosplash > /dev/null 2>&1 &
+ I Exec xss-lock -- xscreensaver-command -lock > /dev/null 2>&1 &

# Menus
DestroyMenu RootMenu
AddToMenu RootMenu
+ DynamicPopUpAction Function CreateRootMenu
+ DynamicPopDownAction DestroyMenu recreate RootMenu

DestroyFunc CreateRootMenu
AddToFunc CreateRootMenu
+ I DestroyMenu recreate RootMenu
+ I AddToMenu RootMenu "Root Menu" Title
+ I AddToMenu RootMenu "Applications" PopUp Applications
+ I AddToMenu RootMenu "urxvt" Exec urxvt
+ I AddToMenu RootMenu "Chromium" Exec chromium
+ I AddToMenu RootMenu "Thunderbird" Exec thunderbird
+ I AddToMenu RootMenu "LibreOffice" Exec libreoffice
+ I AddToMenu RootMenu "" Nop
+ I AddToMenu RootMenu "GTK+ Settings" Exec setgtktheme.py
+ I AddToMenu RootMenu "Set Background" Exec nitrogen
+ I AddToMenu RootMenu "Select Display" Exec display-selector.py
+ I AddToMenu RootMenu "Fvwm Menu" PopUp FvwmMenu
+ I AddToMenu RootMenu "" Nop
+ I AddToMenu RootMenu "Session" PopUp Session

DestroyMenu Applications
AddToMenu Applications
+ DynamicPopUpAction Function CreateAppsMenu
+ DynamicPopDownAction DestroyMenu recreate Applications

DestroyFunc CreateAppsMenu
AddToFunc CreateAppsMenu
+ I DestroyMenu recreate Applications
+ I PipeRead 'mwmmenu -fvwm_dynamic'

DestroyMenu Window-Ops
AddToMenu Window-Ops
+ "Move"			Move
+ "Resize"			Resize
+ "Raise"			Raise
+ "Lower"			Lower
+ ""				Nop
+ "Iconify"			Iconify-and-Focus
+ "Stick"			Stick
+ "Maximize"			Maximize
+ "Shade"			WindowShade
+ ""				Nop
+ "Tile Window"			PopUp TileWindow
+ "Send To"			PopUp SendTo
+ ""				Nop
+ "Close"			Close-and-Focus

DestroyMenu SendTo
AddToMenu SendTo
+ "Page Left"			MoveToPage -1p +0p
+ "Page Right"			MoveToPage +1p +0p
+ "Page Up"			MoveToPage +0p -1p
+ "Page Down"			MoveToPage +0p +1p
+ ""				Nop
+ "Page..."			PopUp SendToPageNumber
+ ""				Nop
+ "Desk Prev"			MoveToDesk-and-Focus -1
+ "Desk Next"			MoveToDesk-and-Focus +1

DestroyMenu SendToPageNumber
AddToMenu SendToPageNumber
+ "Page 0"			MoveToPage 0 0
+ "Page 1"			MoveToPage 1 0
+ "Page 2"			MoveToPage 2 0
+ "Page 3"			MoveToPage 0 1
+ "Page 4"			MoveToPage 1 1
+ "Page 5"			MoveToPage 2 1
+ "Page 6"			MoveToPage 0 2
+ "Page 7"			MoveToPage 1 2
+ "Page 8"			MoveToPage 2 2

DestroyMenu TileWindow
AddToMenu TileWindow
+ "Left Half"			TileLeft
+ "Right Half"			TileRight
+ "Top Half"			TileTop
+ "Bottom Half"			TileBottom
+ ""				Nop
+ "Top Left"			TileTopLeft
+ "Top Right"			TileTopRight
+ "Bottom Left"			TileBottomLeft
+ "Bottom Right"		TileBottomRight

DestroyMenu Themes
AddToMenu Themes
+ DynamicPopUpAction Function CreateThemesMenu
+ DynamicPopDownAction DestroyMenu recreate Themes

DestroyFunc CreateThemesMenu
AddToFunc CreateThemesMenu
+ I DestroyMenu recreate Themes
+ I AddToMenu Themes "Select Theme" Title
+ I PipeRead 'for x in $(ls $FVWM_USERDIR/themes); do echo + ${x} SetTheme ${x}; done'

DestroyMenu FvwmMenu
AddToMenu FvwmMenu
+ DynamicPopUpAction Function CreateFvwmMenu
+ DynamicPopDownAction DestroyMenu recreate FvwmMenu

DestroyFunc CreateFvwmMenu
AddToFunc CreateFvwmMenu
+ I DestroyMenu recreate FvwmMenu
+ I AddToMenu FvwmMenu "Fvwm Menu" Title
+ I AddToMenu FvwmMenu "Themes" PopUp Themes
+ I AddToMenu FvwmMenu "Identify Window" Module FvwmIdent
+ I AddToMenu FvwmMenu "Fvwm Console" Module FvwmConsole
+ I AddToMenu FvwmMenu "About Fvwm" Exec xmessage -center "$(fvwm -version | fold -w 80 -s)" -title "About Fvwm"

DestroyMenu Session
AddToMenu Session "Session" Title
+ "Quit Fvwm"			FvwmForm QuitVerify ACTION="Quit Fvwm" COMMAND="Quit"
+ "Restart Fvwm"		Restart
+ ""				Nop
+ "Lock Screen"			Exec loginctl lock-session
+ ""				Nop
+ "Suspend"			FvwmForm QuitVerify ACTION="Suspend" COMMAND="Exec systemctl suspend"
+ "Hibernate"			FvwmForm QuitVerify ACTION="Hibernate" COMMAND="Exec safehibernate.sh"
+ "Reboot"			FvwmForm QuitVerify ACTION="Reboot" COMMAND="Exec systemctl reboot"
+ "Poweroff"			FvwmForm QuitVerify ACTION="Poweroff" COMMAND="Exec systemctl poweroff"

# Functions
DestroyFunc Move-or-Raise
AddToFunc Move-or-Raise I Raise
+ M Move
+ D Lower

DestroyFunc Move-or-Iconify
AddToFunc Move-or-Iconify I Raise
+ M Move
+ D Iconify-and-Focus

DestroyFunc Resize-or-Raise
AddToFunc Resize-or-Raise I Raise
+ M Resize
+ D Lower

DestroyFunc Focus-and-Raise
AddToFunc Focus-and-Raise
+ I Focus
+ I Raise

# When a window is closed or iconified, FVWM attempts to pass keyboard focus to
# the next window in the stack. However, if the next window in the stack is not
# in the current page then no window gets the keyboard focus. The next four
# functions are workarounds to ensure that when a window is closed or 
# iconified, focus is passed to the next window in the stack that happens to be
# in the current page.
DestroyFunc Iconify-and-Focus
AddToFunc Iconify-and-Focus
+ I Iconify
+ I All (CurrentPage, Focused) Focus-and-Raise
+ I TestRc (NoMatch) Prev (CurrentPage, AcceptsFocus, !Iconic) Focus-and-Raise

DestroyFunc Iconify-and-Focus-OnClick
AddToFunc Iconify-and-Focus-OnClick
+ C Iconify
+ C All (CurrentPage, Focused) Focus-and-Raise
+ C TestRc (NoMatch) Prev (CurrentPage, AcceptsFocus, !Iconic) Focus-and-Raise

DestroyFunc Close-and-Focus
AddToFunc Close-and-Focus
+ I Close
+ I Prev (CurrentPage, AcceptsFocus) Focus-and-Raise

DestroyFunc Close-and-Focus-OnClick
AddToFunc Close-and-Focus-OnClick
+ C Close
+ C Prev (CurrentPage, AcceptsFocus) Focus-and-Raise

# When desk switching or page switching hand keyboard focus to the previously
# focused window in that desk or page. Likewise, if a window is sent to a
# different desk, hand keyboard focus to the previously focused window in that
# desk.
DestroyFunc GoToDesk-and-Focus
AddToFunc GoToDesk-and-Focus
+ I GoToDesk $0
+ I All (CurrentDesk, Focused) Focus-and-Raise
+ I TestRc (NoMatch) Prev (CurrentDesk, AcceptsFocus) Focus-and-Raise

DestroyFunc GoToPage-and-Focus
AddToFunc GoToPage-and-Focus
+ I GoToPage $0 $1
+ I All (CurrentPage, Focused) Focus-and-Raise
+ I TestRc (NoMatch) Prev (CurrentPage, AcceptsFocus) Focus-and-Raise

DestroyFunc MoveToDesk-and-Focus
AddToFunc MoveToDesk-and-Focus
+ I MoveToDesk $0
+ I Prev (CurrentDesk, AcceptsFocus) Focus-and-Raise

DestroyFunc Jump-to-Window
AddToFunc Jump-to-Window
+ I All (CurrentDesk, Focused) Focus-and-Raise
+ I TestRc (NoMatch) Prev (CurrentDesk, AcceptsFocus) Focus-and-Raise

DestroyFunc TileLeft
AddToFunc TileLeft
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 100
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 +0

DestroyFunc TileRight
AddToFunc TileRight
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 100
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move -0 +0

DestroyFunc TileTop
AddToFunc TileTop
+ I ThisWindow (!Shaded, !Iconic) Maximize 100 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 +0

DestroyFunc TileBottom
AddToFunc TileBottom
+ I ThisWindow (!Shaded, !Iconic) Maximize 100 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 -0

DestroyFunc TileTopLeft
AddToFunc TileTopLeft
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 +0

DestroyFunc TileTopRight
AddToFunc TileTopRight
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move -0 +0

DestroyFunc TileBottomLeft
AddToFunc TileBottomLeft
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 -0

DestroyFunc TileBottomRight
AddToFunc TileBottomRight
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move -0 -0

DestroyFunc SetTheme
AddToFunc SetTheme
+ I PipeRead "echo SetEnv FVWM_THEMEPATH `grep Read.*theme $FVWM_USERDIR/config | cut -d ' ' -f 2`"
+ I Exec sed -i "s@$FVWM_THEMEPATH@themes/$0/theme@g" $FVWM_USERDIR/config
+ I UnsetEnv FVWM_THEMEPATH
+ I Restart

# Modules
# FvwmPager
*MainPager: Font "xft:DejaVu Sans:size=9"
*MainPager: ColorSet * 42
*MainPager: HilightColorSet * 44
*MainPager: WindowColorSets 46 47
*MainPager: Window3DBorders
*MainPager: MiniIcons
*MainPager: UseSkipList

# FvwmButtons
*PagerFrame: Geometry 150x140+0+0
*PagerFrame: BoxSize fixed
*PagerFrame: ColorSet 42
*PagerFrame: Rows 140
*PagerFrame: Columns 150
*PagerFrame: (150x120, Container)
*PagerFrame: (Frame 1, Swallow(UseOld, NoClose) "MainPager" Nop)
*PagerFrame: (End)
*PagerFrame: (40x20, Container)
*PagerFrame: (Frame 1, Title "<--", Action (Mouse 1) GoToDesk-and-Focus -1)
*PagerFrame: (End)
*PagerFrame: (70x20, Container)
*PagerFrame: (Frame 1, Title "")
*PagerFrame: (End)
*PagerFrame: (40x20, Container)
*PagerFrame: (Frame 1, Title "-->", Action (Mouse 1) GoToDesk-and-Focus +1)
*PagerFrame: (End)

*WMakerApps: Geometry 128x64-0+0
*WMakerApps: BoxSize fixed
*WMakerApps: ColorSet 42
*WMakerApps: Rows 1
*WMakerApps: Columns 2
*WMakerApps: (Frame 1, Swallow(UseOld, NoClose) "wmclock" Nop)
*WMakerApps: (Frame 1, Swallow(UseOld, NoClose) "wmsystemtray" Nop)

# FvwmForm
*QuitVerify: GrabServer
*QuitVerify: WarpPointer
*QuitVerify: ColorSet 42
*QuitVerify: ItemColorSet 42
*QuitVerify: Font "xft:DejaVu Sans:size=10"
*QuitVerify: ButtonFont "xft:DejaVu Sans:size=9"
*QuitVerify: Command Beep
*QuitVerify: Line center
*QuitVerify: Text "$ACTION?"
*QuitVerify: Line expand
*QuitVerify: Button quit " OK " ^M
*QuitVerify: Command $COMMAND
*QuitVerify: Button quit "Cancel" ^[
*QuitVerify: Command Nop

# vim: ts=8 sts=8 sw=8 noet
