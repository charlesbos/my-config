# Charles' Fvwm configuration file

# Commands
EdgeResistance 250 10
EdgeScroll 100 100
ClickTime 750
DesktopSize 3x3
ColormapFocus FollowsFocus
IgnoreModifiers L25
Emulate Mwm
CursorStyle WAIT left_ptr

# External files
Read themes/KDE1/theme

# Default styles
Style * ColorSet 41, HilightColorSet 40
Style * Icon /usr/share/icons/gnome/48x48/status/image-missing.png
Style * MiniIcon /usr/share/icons/gnome/16x16/status/image-missing.png
Style * DecorateTransient
Style * !UsePPosition 
Style * IconBox +0 +0 -0 -0, IconFill left bottom
#Style * ClickToFocus
Style * SloppyFocus
Style * PositionPlacement center
Style * FPLenient, FPIgnoreRaiseClickMotion, FPSortWindowlistByFocus
Style * !StickyStippledTitle, !StickyStippledIconTitle
Style * ResizeHintOverride
Style * IconSize 57 57
Style * IconBackgroundColorset 43
Style * IconTitleColorset 43, HilightIconTitleColorset 44

# Module styles
Style "MainPager" !Title, Sticky, WindowListSkip, HandleWidth 3, BorderWidth 3, CirculateSkipIcon, CirculateSkip, NeverFocus, Layer 2
Style "PagerFrame" !Title, Sticky, WindowListSkip, HandleWidth 3, BorderWidth 3, CirculateSkipIcon, CirculateSkip, NeverFocus, Layer 2
Style "WMakerApps" !Title, Sticky, WindowListSkip, HandleWidth 3, BorderWidth 3, CirculateSkipIcon, CirculateSkip, NeverFocus, Layer 2
Style "ConfirmForm" !Title, Sticky, WindowListSkip, CirculateSkipIcon, CirculateSkip, !Iconifiable, !Maximizable, !Closable
Style "InputForm" !Title, Sticky, WindowListSkip, CirculateSkipIcon, CirculateSkip, !Iconifiable, !Maximizable, !Closable

# Program styles
Style Gsimplecal !MwmDecor
Style urxvt Icon /usr/share/icons/gnome/48x48/apps/terminal.png, MiniIcon /usr/share/icons/gnome/16x16/apps/terminal.png

# Key bindings
# Window menu, <Alt>tab dialogue and window cycling
Key Escape A C WindowList Root c c NoGeometryWithInfo, IconifiedAtEnd
Key Tab A M WindowList Root c c CurrentDesk, NoGeometryWithInfo, NoDeskNum, CurrentAtEnd, IconifiedAtEnd
Key Next A SCM Next (AcceptsFocus) Focus
Key Prior A SCM Prev (AcceptsFocus) Focus

# The <Alt>F* bindings, primarily for window controls
# We mostly use MWM's defaults here
Key F1 A 1 Menu RootMenu Nop
Key F2 A 1 Launch-and-Warp "bbrun -w"
Key F3 A 1 Lower
Key F4 A 1 Close
Key F5 A 1 Raise
Key F6 A 1 WindowShade
Key F7 A 1 Move
Key F8 A 1 Resize
Key F9 A 1 Iconify
Key F10 A 1 Maximize
Key F11 A 1 Menu Window-Ops Nop

# Lock session, end session and restart the window manager
Key L A C1 Exec loginctl lock-session
Key Delete A C1 FvwmForm ConfirmForm ACTION="Quit Fvwm" COMMAND="Quit"
Key R A C1 Restart

# Page switching
Key Left A C1 GoToPage -1p +0p
Key Right A C1 GoToPage +1p +0p
Key Up A C1 GoToPage +0p -1p
Key Down A C1 GoToPage +0p +1p

# Moving window to page
Key Left A S1 MoveToPage -1w +0w
Key Right A S1 MoveToPage +1w +0w
Key Up A S1 MoveToPage +0w -1w
Key Down A S1 MoveToPage +0w +1w

# Desk switching
Key Up A C4 GoToDesk -1
Key Down A C4 GoToDesk +1
Key G A C1 FvwmForm InputForm ITEM="Go to desk" COMMAND="GoToDesk 0"

# Moving window to desk
Key Up A S4 MoveToDesk -1
Key Down A S4 MoveToDesk +1
Key M A C1 ThisWindow (CurrentPage, Focused) FvwmForm InputForm ITEM="Move to desk" COMMAND="MoveToDesk 0"

# Window tiling
Key Left A 4 TileLeft
Key Right A 4 TileRight
Key Up A 4 TileTop
Key Down A 4 TileBottom
Key Home A 4 TileTopLeft
Key Prior A 4 TileTopRight
Key End A 4 TileBottomLeft
Key Next A 4 TileBottomRight

# The <Super>* bindings - for misc actions
Key I A 4 All (CurrentPage, Iconifiable, AcceptsFocus) Iconify True
Key J A 4 Jump-to-Window CurrentDesk
Key S A 4 ThisWindow (!Iconic, !Shaded) Move 50-50w 50-50w
Key T A 4 Exec urxvt

# Multimedia and screenshot
Key XF86MonBrightnessUp A N Exec xbacklight -inc 10
Key XF86MonBrightnessDown A N Exec xbacklight -dec 10
Key Print A N Exec scrot -e 'xdg-open $f'
Key Print A S Exec tkscrot.py

# Mouse bindings
# Root window
Mouse 1 R A -
Mouse 2	R A -
Mouse 3	R A Menu RootMenu Nop

# Windows/borders/icons
Mouse 1	F A Resize-or-Raise
Mouse 1	TS A Move-or-Raise
Mouse 1	I A Move-or-Iconify
Mouse 1 W 1 Move-or-Raise
Mouse 2	I A Iconify
Mouse 2	FST A RaiseLower
Mouse 3	TSIF A Menu Window-Ops Nop

# Initialisation
DestroyFunc StartFunction
AddToFunc StartFunction
+ I Module FvwmPager MainPager *
+ I Module FvwmButtons PagerFrame
+ I Module FvwmButtons WMakerApps
#+ I Module FvwmEvent FocusEvents
+ I Test (!Init) Break
# Run mwmmenu on startup to avoid a slow firstrun
+ I Exec mwmmenu > /dev/null 2>&1 &
# Pause needed otherwise background not set (race condition??)
+ I Exec sleep 0.2 && nitrogen --restore > /dev/null 2>&1 &
+ I Exec wmsystemtray --non-wmaker > /dev/null 2>&1 &
+ I Exec wmclock -noblink -exe gsimplecal > /dev/null 2>&1 &
+ I Exec nm-applet > /dev/null 2>&1 &
+ I Exec cbatticon -c "xmessage -center 'Power is critically low. Please take action.'" -r 5 > /dev/null 2>&1 &
+ I Exec volumeicon > /dev/null 2>&1 &
+ I Exec blueman-applet > /dev/null 2>&1 &
+ I Exec xscreensaver -nosplash > /dev/null 2>&1 &
+ I Exec xss-lock -- xscreensaver-command -lock > /dev/null 2>&1 &

# Menus
DestroyMenu RootMenu
AddToMenu RootMenu
+ DynamicPopUpAction Function CreateRootMenu
+ DynamicPopDownAction DestroyMenu recreate RootMenu

DestroyFunc CreateRootMenu
AddToFunc CreateRootMenu
+ I DestroyMenu recreate RootMenu
+ I AddToMenu RootMenu "Root Menu" Title
+ I AddToMenu RootMenu "Applications" PopUp Applications
+ I AddToMenu RootMenu "urxvt" Exec urxvt
+ I AddToMenu RootMenu "Chromium" Exec chromium
+ I AddToMenu RootMenu "Thunderbird" Exec thunderbird
+ I AddToMenu RootMenu "LibreOffice" Exec libreoffice
+ I AddToMenu RootMenu "" Nop
+ I AddToMenu RootMenu "GTK+ Settings" Exec setgtktheme.py
+ I AddToMenu RootMenu "Set Background" Exec nitrogen
+ I AddToMenu RootMenu "Select Display" Exec display-selector.py
+ I AddToMenu RootMenu "Fvwm Menu" PopUp FvwmMenu
+ I AddToMenu RootMenu "" Nop
+ I AddToMenu RootMenu "Session" PopUp Session

DestroyMenu Applications
AddToMenu Applications
+ DynamicPopUpAction Function CreateAppsMenu
+ DynamicPopDownAction DestroyMenu recreate Applications

DestroyFunc CreateAppsMenu
AddToFunc CreateAppsMenu
+ I DestroyMenu recreate Applications
+ I PipeRead 'mwmmenu -fvwm_dynamic'

DestroyMenu Window-Ops
AddToMenu Window-Ops
+ "Move"			Move
+ "Resize"			Resize
+ "Raise"			Raise
+ "Lower"			Lower
+ ""				Nop
+ "Iconify"			Iconify
+ "Stick"			Stick
+ "Maximize"			Maximize
+ "Shade"			WindowShade
+ ""				Nop
+ "Tile Window"			PopUp TileWindow
+ "Send To"			PopUp SendTo
+ ""				Nop
+ "Close"			Close

DestroyMenu SendTo
AddToMenu SendTo
+ "Page Left"			MoveToPage -1p +0p
+ "Page Right"			MoveToPage +1p +0p
+ "Page Up"			MoveToPage +0p -1p
+ "Page Down"			MoveToPage +0p +1p
+ ""				Nop
+ "Page..."			PopUp SendToPageNumber
+ ""				Nop
+ "Desk Prev"			MoveToDesk -1
+ "Desk Next"			MoveToDesk +1
+ ""				Nop
+ "Desk..."			FvwmForm InputForm ITEM="Move to desk" COMMAND="MoveToDesk 0"

DestroyMenu SendToPageNumber
AddToMenu SendToPageNumber
+ "Page 0"			MoveToPage 0 0
+ "Page 1"			MoveToPage 1 0
+ "Page 2"			MoveToPage 2 0
+ "Page 3"			MoveToPage 0 1
+ "Page 4"			MoveToPage 1 1
+ "Page 5"			MoveToPage 2 1
+ "Page 6"			MoveToPage 0 2
+ "Page 7"			MoveToPage 1 2
+ "Page 8"			MoveToPage 2 2

DestroyMenu TileWindow
AddToMenu TileWindow
+ "Left Half"			TileLeft
+ "Right Half"			TileRight
+ "Top Half"			TileTop
+ "Bottom Half"			TileBottom
+ ""				Nop
+ "Top Left"			TileTopLeft
+ "Top Right"			TileTopRight
+ "Bottom Left"			TileBottomLeft
+ "Bottom Right"		TileBottomRight

DestroyMenu Themes
AddToMenu Themes
+ DynamicPopUpAction Function CreateThemesMenu
+ DynamicPopDownAction DestroyMenu recreate Themes

DestroyFunc CreateThemesMenu
AddToFunc CreateThemesMenu
+ I DestroyMenu recreate Themes
+ I AddToMenu Themes "Select Theme" Title
+ I PipeRead 'for x in $(ls $FVWM_USERDIR/themes); do echo + ${x} SetTheme ${x}; done'

DestroyMenu FvwmMenu
AddToMenu FvwmMenu
+ DynamicPopUpAction Function CreateFvwmMenu
+ DynamicPopDownAction DestroyMenu recreate FvwmMenu

DestroyFunc CreateFvwmMenu
AddToFunc CreateFvwmMenu
+ I DestroyMenu recreate FvwmMenu
+ I AddToMenu FvwmMenu "Fvwm Menu" Title
+ I AddToMenu FvwmMenu "Themes" PopUp Themes
+ I AddToMenu FvwmMenu "Identify Window" Module FvwmIdent
+ I AddToMenu FvwmMenu "Fvwm Console" Module FvwmConsole
+ I AddToMenu FvwmMenu "About Fvwm" Exec xmessage -center "$(fvwm -version | fold -w 80 -s)" -title "About Fvwm"

DestroyMenu Session
AddToMenu Session "Session" Title
+ "Quit Fvwm"			FvwmForm ConfirmForm ACTION="Quit Fvwm" COMMAND="Quit"
+ "Restart Fvwm"		Restart
+ ""				Nop
+ "Lock Screen"			Exec loginctl lock-session
+ ""				Nop
+ "Suspend"			FvwmForm ConfirmForm ACTION="Suspend" COMMAND="Exec systemctl suspend"
+ "Hibernate"			FvwmForm ConfirmForm ACTION="Hibernate" COMMAND="Exec safehibernate.sh"
+ "Reboot"			FvwmForm ConfirmForm ACTION="Reboot" COMMAND="Exec systemctl reboot"
+ "Poweroff"			FvwmForm ConfirmForm ACTION="Poweroff" COMMAND="Exec systemctl poweroff"

# Functions
# Basic functions
DestroyFunc Move-or-Raise
AddToFunc Move-or-Raise 
+ I Raise
+ M Move

DestroyFunc Move-or-Iconify
AddToFunc Move-or-Iconify 
+ I Raise
+ M Move
+ D Iconify

DestroyFunc Resize-or-Raise
AddToFunc Resize-or-Raise 
+ I Raise
+ M Resize

DestroyFunc Focus-and-Raise
AddToFunc Focus-and-Raise
+ I FlipFocus $0
+ I Raise

DestroyFunc Launch-and-Warp
AddToFunc Launch-and-Warp
+ I Exec $0
+ I WarpToWindow !Raise 50 50

# A function which passes keyboard focus to the window at the top of the stack
# by traversing the stack in reverse order, focusing each window in turn.
# In order to avoid each window being highlighted on traversal, causing a
# flickering effect, we temporarily set the hilight colorset to the background
# one. It's a nasty hack but I can't see any other way of achieving this.
DestroyFunc Focus-Top
AddToFunc Focus-Top
+ I None ($0, AcceptsFocus) Break
+ I Style * HilightColorSet 41
+ I All Reverse UseStack ($0, AcceptsFocus) FlipFocus $1
+ I Style * HilightColorSet 40

# This function first calls the Focus-and-Raise function on a window that is
# already focused and not overlapped by other windows. This is useful for when
# we want to jump to a focused window in a different page. If that fails we
# then call Focus-Top
DestroyFunc Jump-to-Window
AddToFunc Jump-to-Window
+ I All ($0, Focused, !Overlapped) Focus-and-Raise $1
+ I TestRc (NoMatch) Focus-Top $0 $1

# Tiling functions
DestroyFunc TileLeft
AddToFunc TileLeft
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 100
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 +0

DestroyFunc TileRight
AddToFunc TileRight
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 100
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move -0 +0

DestroyFunc TileTop
AddToFunc TileTop
+ I ThisWindow (!Shaded, !Iconic) Maximize 100 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 +0

DestroyFunc TileBottom
AddToFunc TileBottom
+ I ThisWindow (!Shaded, !Iconic) Maximize 100 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 -0

DestroyFunc TileTopLeft
AddToFunc TileTopLeft
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 +0

DestroyFunc TileTopRight
AddToFunc TileTopRight
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move -0 +0

DestroyFunc TileBottomLeft
AddToFunc TileBottomLeft
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move +0 -0

DestroyFunc TileBottomRight
AddToFunc TileBottomRight
+ I ThisWindow (!Shaded, !Iconic) Maximize 50 50
+ I ThisWindow (Maximized, !Shaded, !Iconic) Move -0 -0

# Misc functions
DestroyFunc SetTheme
AddToFunc SetTheme
+ I PipeRead "echo SetEnv FVWM_THEMEPATH `grep Read.*theme $FVWM_USERDIR/config | cut -d ' ' -f 2`"
+ I Exec sed -i "s@$FVWM_THEMEPATH@themes/$0/theme@g" $FVWM_USERDIR/config
+ I UnsetEnv FVWM_THEMEPATH
+ I Restart

# Modules
# FvwmPager
*MainPager: Font "xft:DejaVu Sans:size=9"
*MainPager: ColorSet * 42
*MainPager: HilightColorSet * 44
*MainPager: WindowColorSets 46 47
*MainPager: Window3DBorders
*MainPager: MiniIcons
*MainPager: UseSkipList
*MainPager: Balloons
*MainPager: BalloonColorSet * 42
*MainPager: BalloonFont "xft:DejaVu Sans:size=9"

# FvwmButtons
*PagerFrame: Geometry 153x135+0+0
*PagerFrame: BoxSize fixed
*PagerFrame: ColorSet 42
*PagerFrame: Rows 135
*PagerFrame: Columns 153
*PagerFrame: (153x119, Container)
*PagerFrame: (Frame 1, Swallow(UseOld, NoClose) "MainPager" Nop)
*PagerFrame: (End)
*PagerFrame: (41x16, Container)
*PagerFrame: (Frame 1, Title "<--", Action (Mouse 1) GoToDesk -1)
*PagerFrame: (End)
*PagerFrame: (71x16, Container)
*PagerFrame: (Frame 1, Title "...", Action (Mouse 1) FvwmForm InputForm ITEM="Go to desk" COMMAND="GoToDesk 0", Action (Mouse 3) PipeRead 'echo GoToDesk 0 0')
*PagerFrame: (End)
*PagerFrame: (41x16, Container)
*PagerFrame: (Frame 1, Title "-->", Action (Mouse 1) GoToDesk +1)
*PagerFrame: (End)

*WMakerApps: Geometry 128x64-0+0
*WMakerApps: BoxSize fixed
*WMakerApps: ColorSet 42
*WMakerApps: Rows 1
*WMakerApps: Columns 2
*WMakerApps: (Frame 1, Swallow(UseOld, NoClose) "wmclock" Nop)
*WMakerApps: (Frame 1, Swallow(UseOld, NoClose) "wmsystemtray" Nop)

# FvwmForm
*InputForm: GrabServer
*InputForm: WarpPointer
*InputForm: ColorSet 42
*InputForm: ItemColorSet 42
*InputForm: Font "xft:DejaVu Sans:size=10"
*InputForm: ButtonFont "xft:DejaVu Sans:size=9"
*InputForm: InputFont "xft:DejaVu Sans:size=9"
*InputForm: Command Beep
*InputForm: Line left
*InputForm: Text "$ITEM:"
*InputForm: Input ARG 10
*InputForm: Line expand
*InputForm: Button quit " OK " ^M
*InputForm: Command $COMMAND $(ARG)
*InputForm: Button quit "Cancel" ^[
*InputForm: Command Nop

*ConfirmForm: GrabServer
*ConfirmForm: WarpPointer
*ConfirmForm: ColorSet 42
*ConfirmForm: ItemColorSet 42
*ConfirmForm: Font "xft:DejaVu Sans:size=10"
*ConfirmForm: ButtonFont "xft:DejaVu Sans:size=9"
*ConfirmForm: Command Beep
*ConfirmForm: Line center
*ConfirmForm: Text "$ACTION?"
*ConfirmForm: Line expand
*ConfirmForm: Button quit " OK " ^M
*ConfirmForm: Command $COMMAND
*ConfirmForm: Button quit "Cancel" ^[
*ConfirmForm: Command Nop

# FvwmEvent
# FocusEvents is for use with ClickToFocus only. Disable it
# for any other focus model. Note that it breaks right-click
# panning in FvwmPager
*FocusEvents: new_page "Jump-to-Window CurrentPage NoWarp"
*FocusEvents: new_desk "Focus-Top CurrentDesk"
*FocusEvents: iconify "Focus-Top CurrentPage"
*FocusEvents: deiconify "Focus-Top CurrentPage"
*FocusEvents: destroy_window "Focus-Top CurrentPage"

# vim: ts=8 sts=8 sw=8 noet
